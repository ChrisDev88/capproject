## Generated mta.yaml based on template version 0.2.0
## appName = cockpitcap
## language=java; multiTenant=false
## approuter=
_schema-version: "3.1"
ID: cockpitcap
version: 1.0.0
description: "Generated by cds-services-archetype"
parameters:
  enable-parallel-deployments: true
build-parameters:
  before-all:
    - builder: custom
      commands:
        - npm install
        - cds build/all

modules:
  # ---------------- DATABASE MODULE ----------------------
  - name: cockpitcap-db
    type: hdb
    path: db
    build-parameters:
      ignore: ["node_modules/"]
    parameters:
      memory: 256M
      disk-quota: 256M
    requires:
      - name: cockpitcap-db-hdi-container
      - name: cockpitcap-uaa
  # ---------------- SERVER MODULE ----------------------
  - name: cockpitcap
    type: java
    path: srv
    properties:
      EXIT: 1 # required by deploy.js task to terminate
      SPRING_PROFILES_ACTIVE: cloud
      SAP_JWT_TRUST_ACL:
       - clientid: "*"
         identityzone: "*" 
    build-parameters:
      builder: custom
      commands: [mvn clean package]
      build-result: "target/*.[wj]ar"
    provides:
      - name: srv_api
        properties:
          url: ${default-url}
    requires:
      - name: cockpitcap-db-hdi-container
      - name: cockpitcap-uaa
      - name: cockpitcap-destination-service
      - name: cockpitcap-connectivity-service
  # ---------------- OData V2 PROXY MODULE ----------------------
  - name: cockpitcapv2
    type: nodejs
    path: odatav2-proxy
    build-parameters:
      ignore: ["node_modules/"]
    parameters:
      memory: 256M
      disk-quota: 1G
    provides:
      - name: srv_api_v2
        properties:
          url: "${default-url}"
    requires:
      - name: cockpitcap-uaa
      - name: srv_api
        properties:
          srv_api_url: ~{url}
  # --------------------- UI MODULE ------------------------
  - name: cockpitcapapp
    type: nodejs
    path: app
    build-parameters:
      ignore: ["node_modules/"]
    parameters:
      memory: 256M
      disk-quota: 1024M
    requires:
      - name: cockpitcap-destination-service
      - name: cockpitcap-connectivity-service
      - name: cockpitcap-uaa
      - name: srv_api_v2
        group: destinations
        properties:
          name: srv_api_v2
          url: "~{url}"
          strictSSL: false
          forwardAuthToken: true
      - name: srv_api
        group: destinations
        properties:
          forwardAuthToken: true
          strictSSL: false
          name: srv_api
          url: ~{url}
    properties:
      SAP_JWT_TRUST_ACL:
        - clientid: "*"
          identityzone: "*"
resources:
  - name: cockpitcap-db-hdi-container
    parameters:
      service: hanatrial
      service-plan: hdi-shared
    type: com.sap.xs.hdi-container
    properties:
      hdi-container-name: ${service-name}

  - name: cockpitcap-uaa
    parameters:
      path: ./xs-security.json
      service: xsuaa
      service-plan: application
      config:
        xsappname: cockpitcap-${space}
        tenant-mode: dedicated
    type: org.cloudfoundry.managed-service

  - name: cockpitcap-destination-service
    parameters:
      service-plan: lite
      service: destination
    type: org.cloudfoundry.managed-service

  - name: cockpitcap-connectivity-service
    parameters:
      service-plan: lite
      service: connectivity
    type: org.cloudfoundry.managed-service

  - name: de.datatrain.cockpit
    parameters:
      service-plan: lite
      service: mobile-services
    type: org.cloudfoundry.managed-service